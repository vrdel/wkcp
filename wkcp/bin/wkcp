#!/usr/bin/env python

import sys
import argparse

import wkcp.image
import wkcp.text


def main():
    parser = argparse.ArgumentParser(description="wkcp - Copy/paste and handle text and image attachments from markdowns and vimwikis")
    subparsers = parser.add_subparsers(help="Subcommands", dest="command")
    parser_image = subparsers.add_parser("image", help="Handle images")
    parser_text = subparsers.add_parser("text", help="Handle text")

    parser_image.add_argument("--copy", dest="copyimg", default=False, action='store_true',
                              required=False, help="Copy extracted image path to clipboard")
    parser_text.add_argument("--copy", dest="copytext", type=bool, default=False,
                             required=False, help="Copy text to clipboard")
    args = parser.parse_args()

    stdin_content = sys.stdin.read()
    sys.stdin = open("/dev/tty")

    if args.command == "image":
        wkcp.image.handle(args, stdin_content)
    elif args.command == "text":
        wkcp.text.handle(args, stdin_content)


if __name__ == '__main__':
    main()
